<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>表单项配置</title>
<link rel="stylesheet" href="../css/main.css" />
<script type="text/javascript" src="../js/vue.min.js"></script>
<script type="text/javascript" src="../js/jquery-3.3.1.min.js"></script>
<!-- 引入样式 -->
<link rel="stylesheet" href="https://unpkg.com/element-ui@2.4.3/lib/theme-chalk/index.css">
<!-- 引入组件库 -->
<script src="https://unpkg.com/element-ui@2.4.3/lib/index.js"></script>
</head>
<body>



<div id="app">
<el-row>
	<el-col :span="4">
	<div class="topbar">
  		<el-input  v-model="parentid" placeholder="请输入父Id" @change="search" prefix-icon="el-icon-search"></el-input>
	</div>
	</el-col>
	<el-col :span="4">
	<div class="topbar">
  		<el-input  v-model="inputkey" placeholder="请输入属性名关键字" @change="search" prefix-icon="el-icon-search"></el-input>
	</div>
	</el-col>
	<el-col :span="2">
  	<el-button type="primary" icon="el-icon-edit" circle @click="dialogVisible = true"></el-button>
  	</el-col>
</el-row>

<el-dialog title="添加" :visible.sync="dialogVisible">
  <el-form :model="form">
  	<el-form-item label="父Id" :label-width="formLabelWidth">
      <el-input v-model="form.parentId" auto-complete="off"></el-input>
    </el-form-item>
  	<el-form-item label="属性名称" :label-width="formLabelWidth">
      <el-input v-model="form.attrName" auto-complete="off"></el-input>
    </el-form-item>
    <el-form-item label="标签" :label-width="formLabelWidth">
      <el-input v-model="form.label" auto-complete="off"></el-input>
    </el-form-item>
   <el-form-item label="控件类型" :label-width="formLabelWidth">
     <el-select v-model="form.controlType">
      	<el-option label="TextBox" value="TextBox"></el-option>
      	<el-option label="TextArea" value="TextArea"></el-option>
      	<el-option label="Select" value="Select"></el-option>
      	<el-option label="SQLSelect" value="SQLSelect"></el-option>
      	<el-option label="Department" value="Department"></el-option>
      	<el-option label="Date" value="Date"></el-option>
      	<el-option label="Boolean" value="Boolean"></el-option>
      	<el-option label="Integer" value="Integer"></el-option>
      	<el-option label="Classification" value="Classification"></el-option>
    </el-select>
    </el-form-item>
    <el-form-item label="宽度类型" :label-width="formLabelWidth">
     <el-select v-model="form.widthType">
      	<el-option label="1" value="1"></el-option>
      	<el-option label="2" value="2"></el-option>
      	<el-option label="3" value="3"></el-option>
      	<el-option label="4" value="4"></el-option>
    </el-select>
    </el-form-item>
      <el-form-item label="必填" :label-width="formLabelWidth">
                	<el-select v-model="form.required">
      					<el-option label="否" value="0"></el-option>
      					<el-option label="是" value="1"></el-option>
    				</el-select>
    </el-form-item>
    <el-form-item label="只读" :label-width="formLabelWidth">
                	<el-select v-model="form.readOnly">
      					<el-option label="否" value="0"></el-option>
      					<el-option label="是" value="1"></el-option>
    				</el-select>
    </el-form-item>
     <el-form-item label="是否可查询" :label-width="formLabelWidth">
                	<el-select v-model="form.searchable">
      					<el-option label="否" value="0"></el-option>
      					<el-option label="是" value="1"></el-option>
    				</el-select>
    </el-form-item>
    <el-form-item label="默认值" :label-width="formLabelWidth">
                <el-input  v-model="form.defaultValue"></el-input>
	</el-form-item>
    <el-form-item label="序号" :label-width="formLabelWidth">
      <el-input v-model="form.orderIndex" auto-complete="off"></el-input>
    </el-form-item>
  </el-form>
  <div slot="footer" class="dialog-footer">
    <el-button @click="dialogVisible = false">取 消</el-button>
    <el-button type="primary" @click="additem(form)">确 定</el-button>
  </div>
</el-dialog>
<table>
            <tr>
            	<td width="40px">ID</td>
            	<td width="40px">父ID</td>
                <td width="160px">属性名称</td>
                <td width="160px">标签</td>
                <td width="120px">控件类型</td>
                <td width="80px">宽度类型</td>
                <td width="80px">必填</td>
                <td width="80px">只读</td>
                <td width="80px">是否可查询</td>
                <td width="120px">默认值</td>
                <td width="100px">序号</td>
                <td width="160px">操作</td>
            </tr>
            <tr v-for="item in dataList">
            	<td>{{item.id}}</td>
            	<td>
                <el-input  v-model="item.parentId"></el-input>
				</td>
                <td>
                <el-input  v-model="item.attrName"></el-input>
				</td>
                <td>
                <el-input  v-model="item.label"></el-input>
                </td>
                 <td>
                <el-input  v-model="item.controlType"></el-input>
                </td>
                <td>
                	<el-select v-model="item.widthType">
      					<el-option label="1" value="1"></el-option>
      					<el-option label="2" value="2"></el-option>
      					<el-option label="3" value="3"></el-option>
      					<el-option label="4" value="4"></el-option>
    				</el-select>
                </td>
                 <td>
                	<el-select v-model="item.required">
      					<el-option label="否" value="0"></el-option>
      					<el-option label="是" value="1"></el-option>
    				</el-select>
                </td>
                 <td>
                	<el-select v-model="item.readOnly">
      					<el-option label="否" value="0"></el-option>
      					<el-option label="是" value="1"></el-option>
    				</el-select>
                </td>
                <td>
                	<el-select v-model="item.searchable">
      					<el-option label="否" value="0"></el-option>
      					<el-option label="是" value="1"></el-option>
    				</el-select>
                </td>
                 <td>
                <el-input  v-model="item.defaultValue"></el-input>
                </td>
                <td>
                <el-input  v-model="item.orderIndex"></el-input>
                </td>
                <td>
                	<el-button type="primary" @click="save(item)" size="small">保存</el-button>
                	<el-button type="danger" @click="del(item)" size="small">删除</el-button>
                </td>
            </tr>
        </table>
</div>

<script type="text/javascript">

function oneValues(){
	var result;
	var url=window.location.search; //获取url中"?"符后的字串 
	
	if(url.indexOf("?")!=-1){
	result = url.substr(url.indexOf("=")+1);
	}
	return result;
	}

$.ajaxSetup({  
    contentType : 'application/json'  
});

var pid =oneValues();

     new Vue({
            el:'#app',
            data:{
                dataList:"",
                dataListFull:"",
                inputkey:"",
                parentid:"",
                dialogVisible:false,
                form: {
                    name: '',
                    description: '',
                    value: ''
                },
                formLabelWidth: '120px'
            },
            created:function(){
            	var url="/admin/getFormItem";
        	    var _self = this;
        	    _self.parentid=pid;
        	    $.get(url, function (data) {
        	        _self.dataListFull = data.list;
        	    	_self.dataList = data.list;
        	    	if(pid!="")
            	    {
                	    _self.search();
            	    }
        	   });
            },
            methods:{
            	refreshData:function()
            	{
            		var url="/admin/getFormItem";
            	    var _self = this;
            	    $.get(url, function (data) {
            	    	_self.dataListFull = data.list;
            	    	_self.dataList = data.list;
            	   });
            	},
				save:function(indata)
				{
					
					$.ajax({
							url: "/admin/updateFormItem",
							datatype:"json",
							type:'post',
							data:JSON.stringify(indata),
							success:function(data){
							   alert("保存成功!");
							}
					});  		
				},
				del:function(indata)
				{
					var _self = this;
					$.ajax({
						url: "/admin/deleteFormItem",
						datatype:"json",
						type:'post',
						data:JSON.stringify(indata),
						success:function(data){
						   alert("删除成功!");
						   _self.refreshData();
						}
				});  
				},
				additem:function(indata)
				{
					var _self = this;
					
					$.ajax({
						url: "/admin/newFormItem",
						datatype:"json",
						type:'post',
						data:JSON.stringify(indata),
						success:function(data){
							_self.dialogVisible=false;
						  // alert("添加成功!");
						   _self.refreshData();
						   //var url="/admin/getFormItem";
		            	   
		            	  //  $.get(url, function (data) {
		            	        
		            	    	//_self.dataList = data.list;
		            	  // });
						}
					});  
				},
				search:function()
				{
					
					var _self=this;
                    var tab=_self.dataListFull;                          
                    _self.dataList=[]; 
                    if(_self.inputkey!=""||_self.parentid!="")
					{                  
                       for(i in tab) 
                       {
                            if(_self.inputkey!="")
                            {
                                if(tab[i].attrName.indexOf(_self.inputkey) >= 0||tab[i].label.indexOf(_self.inputkey) >= 0)
                                {
	                                if(_self.parentid!="")
	                            	{
	                                	if(tab[i].parentId==_self.parentid)
	                                    {
	                                		_self.dataList.push(tab[i]);
	                                    }
	                            	}
	                                else
	                                {
	                                	_self.dataList.push(tab[i]);
	                                }
                                 }
                            }
                            else  if(_self.parentid!="")
                        	{
                            	//alert(tab[i].parentId+","+_self.parentid);
                            	if(tab[i].parentId==_self.parentid)
                                {
                            		_self.dataList.push(tab[i]);
                                }
                        	}
                                
                        }
                    }
                    else
                    {
                    	_self.dataList = _self.dataListFull;
                    }
                    
				},
				showitem:function(indata)
				{

				}
            }
                
          });

     //new Vue().$mount('#app');
</script>
</body>
</html>